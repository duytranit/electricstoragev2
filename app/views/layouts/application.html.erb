<!DOCTYPE html>
<html>
<head>
  <title>Electricstoragev2</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
</head>
<body>
<div id="header">
  <div id="logo">
    <h1><%= link_to "Electric Storage", root_path %></h1>
    
    <h2><a href="#">So Khoa Hoc va Cong Nghe</a></h2>
  </div>
  <div id="menu">
    <% if user_signed_in? %>
      <% if current_user.is_staff? %>
        <%= render '/shared/staff_navigate' %>
      <% else %>
        <%= render '/shared/customer_navigate' %>
      <% end %>
    <% else %>
      <ul>
        <li class=<%if controller.controller_name == 'welcome'%> 'active' <%end%> > <%= link_to "Trang chủ", root_path %></li>
        <li class=<% if controller.controller_name == 'projects' %>'active'<% end %>>
          <%= link_to "Project", projects_path %>
        </li>
        <li class=<% if controller.controller_name == 'introduce' %> 'active' <% end %>>
          <%= link_to "Introduce", introduce_index_path %>
        </li>
        <li class=<% if controller.controller_name == 'contact' %> 'active' <% end %>>
          <%= link_to "Contact", contact_index_path %>
        </li>
      </ul>
    <% end %>

      
  </div>
</div>
<div id="content">
  <div id="colOne">
    <%= yield %>
  </div>
  <div id="colTwo">
    <ul>
      <li>
        <h2><span>Tiềm kiếm</span></h2>

        <%= form_tag welcome_index_path, method: :get do %>
          <table style="width: 100%">
            <tr>
              <td>
                <%= text_field_tag :search, params[:search], placeholder: "project's title", class: "search" %>
                <%= select_tag :procategory_id, options_from_collection_for_select(Procategory.where(["status = ?", true]), :id, :name, params[:procategory_id]), class: "search", prompt: "All categories" %>
              <td>
              <td>
                <%= submit_tag "Search", type: :image, src: '../assets/search.png', title: "Search projects", rel: 'tooltip' %>
              </td>
            </tr>
          </table>
        <% end %>


      </li>

      <li>
        <h2>
          <span>Sign in</span>
        </h2>
        <ul>
          <li>
            <% flash.each do |name, msg| %>
              <%= content_tag :div, msg, id: "flash_#{name}" %>
              <br />
            <% end %>            

            <div id="user_nav">
              <% if user_signed_in? %>
                <% if current_user.avatar_file_name %>
                  <%= image_tag current_user.avatar.url(:small)%>
                <% else %>
                  <%= image_tag "../assets/userAvatar.png" %>
                <% end %>
                Welcome <strong><%= current_user.first_name + " " + current_user.last_name %></strong> <br />
                <%= link_to 'Edit profile', edit_user_registration_path %> |
                <%= link_to "Logout", destroy_user_session_path, method: :delete %>
              <% else %>
                <%= link_to image_tag("../assets/register.png"), new_user_registration_path %>
                <%= link_to "Sign up", new_user_registration_path %> |
                <%= link_to "Login", new_user_session_path %>
              <% end %>
            </div>            
          </li>
        </ul>
      </li>

      <% if (session[:storage]) && (session[:storage].count > 0) %>
        <li>
          <h2>
            <span>Your storage ( <%= session[:storage].count %> )</span>
          </h2>
          <ul>
            <li>
              <table style="width: 100%">
                <tr>
                  <td>
                    <ul>
                      <% i = session[:storage].count %>
                      <% session[:storage][(i-2)..(i-1)].each do |id| %>
                        <li>
                          <% project = Project.find(id) %>
                          <table style="width: 100%">
                            <tr>
                              <td>
                                <%= link_to truncate(project.title, length: 20), project %>
                              </td>
                              <td style="text-align: right">
                                <%= link_to "x", remove_project_out_invoice_invoices_path(project_id: project.id), method: :post, data: { confirm: "Do you really want to remove project \"" + project.title + "\"" } %>
                              </td>
                            </tr>
                          </table>
                        </li>                        
                      <% end %>
                      <% if session[:storage].count > 2 %>
                        <li>
                          <table style="width: 100%">
                            <tr>
                              <td style="text-align: right">
                                <%= link_to "show all ...", new_invoice_path %>
                              </td>
                            </tr>
                          </table>                          
                        </li>
                      <% end %>                      
                  </td>
                </tr>
                <tr>
                  <td style="text-align: right;">
                    <%= link_to image_tag("../assets/payment.png"), new_invoice_path %>
                  </td>
                </tr>
              </table>              
            </li>            
          </ul>
        </li>
      <% end %>

      <% procategories = Procategory.where(["status = ?", true]) %>
      <% if ( procategories.count > 0 ) %>
        <li>
          <h2><span>Categories</span></h2>        
          <ul>
            <% procategories.each do |pc| %>
              <li>
                <%= link_to pc.name, pc %>
              </li>
            <% end %>
          </ul>
        </li>
      <% end %>
    </ul>
  </div>
  <div style="clear: both;">&nbsp;</div>
</div>
<div id="footer">
  <p>SỞ KHOA HỌC VÀ CÔNG NGHỆ TỈNH BẾN TRE</p>
  <p>Địa chỉ: Số 280 đường 3/2- Phường 3 - Tp Bến Tre. | Điện thoại : 075.3827358 | Fax : 075.3823179 | Email: banbientap@dost-bentre.gov.vn</p>
</div>
</body>
</html>
